{"version":3,"sources":["configure.js"],"names":["define","files","FileSystem","ErrorCodes","FileError","registry","fs","configure","config","cb","getFileSystem","fsName","EPERM","options","let","waitCount","called","finish","fsc","get","Create","finishedIterating","props","Object","keys","filter","k","forEach","d","p","e","provider","initialize"],"mappings":";;;;;;;AAAAA,OAAO,CACH,UACA,gBACA,gBACA,eACA,wBACD,SAASC,EAAOC,EAAYC,EAAWC,EAAUC,GAChD,aAEA,IAAIC,EAAKL,EAAMK,GAAK,IAAIJ,EAiFxB,OAAOD,EAAMM,UArEb,SAAmBC,EAAQC,GACvBC,CAeJ,SAASA,EAAcF,EAAQC,GAC3B,MAAME,EAASH,EAAW,GAC1B,GAAI,CAACG,EACD,OAAOF,EAAG,IAAIL,EAAUD,EAAWS,MAAO,gDAAgD,CAAC,EAE/F,MAAMC,EAAUL,EAAgB,QAChCM,IAAIC,EAAY,EAChBD,IAAIE,EAAS,CAAA,EACb,SAASC,IACL,GAAI,CAACD,EAAQ,CACTA,EAAS,CAAA,EACT,MAAME,EAAMb,EAASc,IAAIR,CAAM,EAC1BO,EAIDA,EAAIE,OAAOP,EAASJ,CAAE,EAHtBA,EAAG,IAAIL,EAAUD,EAAWS,qBAAsBD,kCAAuC,CAAC,CAKlG,CACJ,CACA,GAAgB,OAAZE,GAAyC,UAArB,OAAO,EAAwB,CACnDC,IAAIO,EAAoB,CAAA,EACxB,MAAMC,EAAQC,OAAOC,KAAKX,CAAO,EAAEY,OAAO,GAAa,OAANC,CAAU,EAE3DJ,EAAMK,QAAQ,IACV,MAAMC,EAAIf,EAAQgB,GACR,OAAND,GAA6B,UAAf,OAAO,GAAoBA,EAAM,KAC/Cb,CAAS,GACTL,EAAckB,EAAG,SAAUE,EAAGxB,GAC1BS,CAAS,GACLe,EACId,IAGJA,EAAS,CAAA,EACTP,EAAGqB,CAAC,IAGJjB,EAAQgB,GAAKvB,EACK,IAAdS,GAAmBM,GACnBJ,EAAO,EAGnB,CAAC,EAET,CAAC,EACDI,EAAoB,CAAA,CACxB,CACkB,IAAdN,GACAE,EAAO,CAEf,EAlEkBT,EAAQ,CAACsB,EAAGC,KAClBA,GARDzB,EAAG0B,WASSD,CATQ,EAUnBtB,EAAG,KAAKH,CAAE,GAGVG,EAAGqB,CAAC,CAEZ,CAAC,CACL,CA4DJ,CAAC","file":"../configure.js","sourcesContent":["define([\r\n    \"./files\",\r\n    './file-system',\r\n    \"./error-codes\",\r\n    \"./file-error\",\r\n    './providers/registry',\r\n], function(files, FileSystem, ErrorCodes,FileError,registry) {\r\n    'use strict';\r\n\r\n    var fs = files.fs = new FileSystem();\r\n\r\n    /**\r\n     * Initializes BrowserFS with the given root file system.\r\n     */\r\n    function initialize(rootfs) {\r\n        return fs.initialize(rootfs);\r\n    }\r\n    /**\r\n     * Creates a file system with the given configuration, and initializes BrowserFS with it.\r\n     * See the FileSystemConfiguration type for more info on the configuration object.\r\n     */\r\n    function configure(config, cb) {\r\n        getFileSystem(config, (e, provider) => {\r\n            if (provider) {\r\n                initialize(provider);\r\n                cb(null,fs);\r\n            }\r\n            else {\r\n                cb(e);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Retrieve a file system with the given configuration.\r\n     * @param config A FileSystemConfiguration object. See FileSystemConfiguration for details.\r\n     * @param cb Called when the file system is constructed, or when an error occurs.\r\n     */\r\n    function getFileSystem(config, cb) {\r\n        const fsName = config['fs'];\r\n        if (!fsName) {\r\n            return cb(new FileError(ErrorCodes.EPERM, 'Missing \"fs\" property on configuration object.'));\r\n        }\r\n        const options = config['options'];\r\n        let waitCount = 0;\r\n        let called = false;\r\n        function finish() {\r\n            if (!called) {\r\n                called = true;\r\n                const fsc = registry.get(fsName);\r\n                if (!fsc) {\r\n                    cb(new FileError(ErrorCodes.EPERM, `File system ${fsName} is not available in BrowserFS.`));\r\n                }\r\n                else {\r\n                    fsc.Create(options, cb);\r\n                }\r\n            }\r\n        }\r\n        if (options !== null && typeof (options) === \"object\") {\r\n            let finishedIterating = false;\r\n            const props = Object.keys(options).filter((k) => k !== 'fs');\r\n            // Check recursively if other fields have 'fs' properties.\r\n            props.forEach((p) => {\r\n                const d = options[p];\r\n                if (d !== null && typeof (d) === \"object\" && d['fs']) {\r\n                    waitCount++;\r\n                    getFileSystem(d, function (e, fs) {\r\n                        waitCount--;\r\n                        if (e) {\r\n                            if (called) {\r\n                                return;\r\n                            }\r\n                            called = true;\r\n                            cb(e);\r\n                        }\r\n                        else {\r\n                            options[p] = fs;\r\n                            if (waitCount === 0 && finishedIterating) {\r\n                                finish();\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            finishedIterating = true;\r\n        }\r\n        if (waitCount === 0) {\r\n            finish();\r\n        }\r\n    }\r\n\r\n    return files.configure = configure;\r\n});"]}