/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-binary/buffer","skylark-langx-paths","../files","../error-codes","../file-error","../action-type","../file-flag","../utils"],function(l,s,n,o,a,S,e,t){"use strict";const h=t["fail"];return n.providers.BaseProvider=class{supportsLinks(){return!1}diskSpace(n,t){t(0,0)}openFile(n,t,e){throw new a(o.ENOTSUP)}createFile(n,t,e,r){throw new a(o.ENOTSUP)}open(e,r,i,c){this.stat(e,!1,(n,t)=>{if(n)switch(r.pathNotExistsAction()){case S.CREATE_FILE:return this.stat(s.dirname(e),!1,(n,t)=>{n?c(n):t&&!t.isDirectory()?c(a.ENOTDIR(s.dirname(e))):this.createFile(e,r,i,c)});case S.THROW_EXCEPTION:return c(a.ENOENT(e));default:return c(new a(o.EINVAL,"Invalid FileFlag object."))}else{if(t&&t.isDirectory())return c(a.EISDIR(e));switch(r.pathExistsAction()){case S.THROW_EXCEPTION:return c(a.EEXIST(e));case S.TRUNCATE_FILE:return this.openFile(e,r,(n,t)=>{n?c(n):t?t.truncate(0,()=>{t.sync(()=>{c(null,t)})}):h()});case S.NOP:return this.openFile(e,r,c);default:return c(new a(o.EINVAL,"Invalid FileFlag object."))}}})}rename(n,t,e){e(new a(o.ENOTSUP))}renameSync(n,t){throw new a(o.ENOTSUP)}stat(n,t,e){e(new a(o.ENOTSUP))}statSync(n,t){throw new a(o.ENOTSUP)}openFileSync(n,t,e){throw new a(o.ENOTSUP)}createFileSync(n,t,e){throw new a(o.ENOTSUP)}openSync(t,e,r){let n;try{n=this.statSync(t,!1)}catch(n){switch(e.pathNotExistsAction()){case S.CREATE_FILE:if(this.statSync(s.dirname(t),!1).isDirectory())return this.createFileSync(t,e,r);throw a.ENOTDIR(s.dirname(t));case S.THROW_EXCEPTION:throw a.ENOENT(t);default:throw new a(o.EINVAL,"Invalid FileFlag object.")}}if(n.isDirectory())throw a.EISDIR(t);switch(e.pathExistsAction()){case S.THROW_EXCEPTION:throw a.EEXIST(t);case S.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,n.mode);case S.NOP:return this.openFileSync(t,e,r);default:throw new a(o.EINVAL,"Invalid FileFlag object.")}}unlink(n,t){t(new a(o.ENOTSUP))}unlinkSync(n){throw new a(o.ENOTSUP)}rmdir(n,t){t(new a(o.ENOTSUP))}rmdirSync(n){throw new a(o.ENOTSUP)}mkdir(n,t,e){e(new a(o.ENOTSUP))}mkdirSync(n,t){throw new a(o.ENOTSUP)}readdir(n,t){t(new a(o.ENOTSUP))}readdirSync(n){throw new a(o.ENOTSUP)}exists(n,t){this.stat(n,null,function(n){t(!n)})}existsSync(n){try{return this.statSync(n,!0),!0}catch(n){return!1}}realpath(t,n,e){if(this.supportsLinks()){var r=t.split(s.sep);for(let n=0;n<r.length;n++){var i=r.slice(0,n+1);r[n]=s.join.apply(null,i)}}else this.exists(t,function(n){n?e(null,t):e(a.ENOENT(t))})}realpathSync(n,t){if(this.supportsLinks()){var e=n.split(s.sep);for(let n=0;n<e.length;n++){var r=e.slice(0,n+1);e[n]=s.join.apply(path,r)}return e.join(s.sep)}if(this.existsSync(n))return n;throw a.ENOENT(n)}truncate(n,t,r){this.open(n,e.getFileFlag("r+"),420,function(n,e){if(n)return r(n);e.truncate(t,function(t){e.close(function(n){r(t||n)})})})}truncateSync(n,t){n=this.openSync(n,e.getFileFlag("r+"),420);try{n.truncateSync(t)}catch(n){throw n}finally{n.closeSync()}}readFile(n,i,t,c){const s=c;this.open(n,t,420,(n,r)=>{if(n)return c(n);c=function(t,e){r.close(function(n){return t=t||n,s(t,e)})},r.stat((n,t)=>{if(n)return c(n);const e=l.alloc(t.size);r.read(e,0,t.size,0,n=>{if(n)return c(n);if(null===i)return c(n,e);try{c(null,e.toString(i))}catch(n){c(n)}})})})}readFileSync(n,t,e){n=this.openSync(n,e,420);try{var r=n.statSync(),i=l.alloc(r.size);return n.readSync(i,0,r.size,0),n.closeSync(),null===t?i:i.toString(t)}finally{n.closeSync()}}writeFile(n,t,r,e,i,c){const s=c;this.open(n,e,420,function(n,e){if(n)return c(n);c=function(t){e.close(function(n){s(t||n)})};try{"string"==typeof t&&(t=l.from(t,r))}catch(n){return c(n)}e.write(t,0,t.length,0,c)})}writeFileSync(n,t,e,r,i){n=this.openSync(n,r,i);try{"string"==typeof t&&(t=l.from(t,e)),n.writeSync(t,0,t.length,0)}finally{n.closeSync()}}appendFile(n,t,r,e,i,c){const s=c;this.open(n,e,i,function(n,e){if(n)return c(n);c=function(t){e.close(function(n){s(t||n)})},"string"==typeof t&&(t=l.from(t,r)),e.write(t,0,t.length,null,c)})}appendFileSync(n,t,e,r,i){n=this.openSync(n,r,i);try{"string"==typeof t&&(t=l.from(t,e)),n.writeSync(t,0,t.length,null)}finally{n.closeSync()}}chmod(n,t,e,r){r(new a(o.ENOTSUP))}chmodSync(n,t,e){throw new a(o.ENOTSUP)}chown(n,t,e,r,i){i(new a(o.ENOTSUP))}chownSync(n,t,e,r){throw new a(o.ENOTSUP)}utimes(n,t,e,r){r(new a(o.ENOTSUP))}utimesSync(n,t,e){throw new a(o.ENOTSUP)}link(n,t,e){e(new a(o.ENOTSUP))}linkSync(n,t){throw new a(o.ENOTSUP)}symlink(n,t,e,r){r(new a(o.ENOTSUP))}symlinkSync(n,t,e){throw new a(o.ENOTSUP)}readlink(n,t){t(new a(o.ENOTSUP))}readlinkSync(n){throw new a(o.ENOTSUP)}}});
//# sourceMappingURL=../sourcemaps/providers/base-provider.js.map
