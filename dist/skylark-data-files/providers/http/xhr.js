/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-binary/buffer","../../error-codes","../../file-error","../../utils"],function(a,u,c,e){"use strict";const{isIE:n,emptyBuffer:o}=e;function r(e,n,t){const r=new XMLHttpRequest;r.open("HEAD",n,e),r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return t(new c(u.EIO,"XHR HEAD error: response returned code "+r.status));try{return t(null,parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(e){return t(new c(u.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}return{xhrIsAvailable:"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest,asyncDownloadFile:function(e,n,t){const r=new XMLHttpRequest;r.open("GET",e,!0);let s=!0;switch(n){case"buffer":r.responseType="arraybuffer";break;case"json":try{r.responseType="json",s="json"===r.responseType}catch(e){s=!1}break;default:return t(new c(u.EINVAL,"Invalid download type: "+n))}r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return t(new c(u.EIO,"XHR error: response returned code "+r.status));switch(n){case"buffer":return t(null,r.response?a.from(r.response):o());case"json":return s?t(null,r.response):t(null,JSON.parse(r.responseText))}}},r.send()},syncDownloadFile:n&&"undefined"!=typeof Blob?function(e,n){const t=new XMLHttpRequest;switch(t.open("GET",e,!1),n){case"buffer":t.responseType="arraybuffer";break;case"json":break;default:throw new c(u.EINVAL,"Invalid download type: "+n)}let r,s;if(t.onreadystatechange=function(e){if(4===t.readyState)if(200===t.status)switch(n){case"buffer":r=a.from(t.response);break;case"json":r=JSON.parse(t.response)}else s=new c(u.EIO,"XHR error: response returned code "+t.status)},t.send(),s)throw s;return r}:function(e,t){const r=new XMLHttpRequest;r.open("GET",e,!1);let s=null,o=null;if(r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(e){if(4===r.readyState)if(200===r.status)switch(t){case"buffer":var n=r.responseText;s=a.alloc(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);return;case"json":return void(s=JSON.parse(r.responseText))}else o=new c(u.EIO,"XHR error: response returned code "+r.status)},r.send(),o)throw o;return s},getFileSizeSync:function(e){let t=-1;return r(!1,e,function(e,n){if(e)throw e;t=n}),t},getFileSizeAsync:function(e,n){r(!0,e,n)}}});
//# sourceMappingURL=../../sourcemaps/providers/http/xhr.js.map
