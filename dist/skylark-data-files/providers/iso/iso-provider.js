/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-paths","../synchronous-provider","../../no-sync-file","../../stats","../../file-type","../../action-type","../../file-error","../../error-codes","../../utils"],function(h,t,o,l,d,n,c,u,e){"use strict";const{copyingSlice:s,bufferValidator:r}=e;class i extends t{constructor(t,e=""){super(),this._data=t;let r=!1,i=32768;for(var s=new Array;!r;){var a=t.slice(i);switch(new VolumeDescriptor(a).type()){case 1:s.push(new PrimaryVolumeDescriptor(a));break;case 2:s.push(new SupplementaryVolumeDescriptor(a));break;case 255:r=!0}i+=2048}if(0===s.length)throw new c(u.EIO,"Unable to find a suitable volume descriptor.");s.forEach(t=>{this._pvd&&2===this._pvd.type()||(this._pvd=t)}),this._root=this._pvd.rootDirectoryEntry(t),this._name=e}static Create(t,e){try{e(null,new i(t.data,t.name))}catch(t){e(t)}}static isAvailable(){return!0}getName(){let t="IsoProvider"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(t+="-RockRidge"),t}diskSpace(t,e){e(this._data.length,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}statSync(t,e){var r=this._getDirectoryRecord(t);if(null===r)throw c.ENOENT(t);return this._getStats(t,r)}openSync(t,e,r){if(e.isWriteable())throw new c(u.EPERM,t);var i=this._getDirectoryRecord(t);if(!i)throw c.ENOENT(t);if(i.isSymlink(this._data))return this.openSync(h.resolve(t,i.getSymlinkPath(this._data)),e,r);if(i.isDirectory(this._data))throw c.EISDIR(t);var s=i.getFile(this._data),a=this._getStats(t,i);switch(e.pathExistsAction()){case n.THROW_EXCEPTION:case n.TRUNCATE_FILE:throw c.EEXIST(t);case n.NOP:return new o(this,t,e,a,s);default:throw new c(u.EINVAL,"Invalid FileMode object.")}}readdirSync(t){var e=this._getDirectoryRecord(t);if(e){if(e.isDirectory(this._data))return e.getDirectory(this._data).getFileList().slice(0);throw c.ENOTDIR(t)}throw c.ENOENT(t)}readFileSync(t,e,r){t=this.openSync(t,r,420);try{var i=t.getBuffer();return null===e?s(i):i.toString(e)}finally{t.closeSync()}}_getDirectoryRecord(t){if("/"===t)return this._root;t=t.split("/").slice(1);let e=this._root;for(const r of t){if(!e.isDirectory(this._data))return null;if(!(e=e.getDirectory(this._data).getRecord(r)))return null}return e}_getStats(s,a){if(a.isSymlink(this._data))return s=h.resolve(s,a.getSymlinkPath(this._data)),(n=this._getDirectoryRecord(s))?this._getStats(s,n):null;{s=a.dataLength();let t=365;var o,n=a.recordingDate().getTime();let e=n,r=n,i=n;if(a.hasRockRidge())for(const c of a.getSUEntries(this._data))c instanceof PXEntry?t=c.mode():c instanceof TFEntry&&(4&(o=c.flags())&&(e=c.access().getTime()),2&o&&(r=c.modify().getTime()),1&o)&&(i=c.creation().getTime());return t&=365,new l(a.isDirectory(this._data)?d.DIRECTORY:d.FILE,s,t,e,r,i)}}}return i.Name="Iso",i.Options={data:{type:"object",description:"The ISO file in a buffer",validator:r}},i});
//# sourceMappingURL=../../sourcemaps/providers/iso/iso-provider.js.map
